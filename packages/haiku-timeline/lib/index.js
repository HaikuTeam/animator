'use strict';

var _jsxFileName = 'src/index.js';

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _reactDom = require('react-dom');

var _reactDom2 = _interopRequireDefault(_reactDom);

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _qs = require('qs');

var _qs2 = _interopRequireDefault(_qs);

var _Websocket = require('haiku-serialization/src/ws/Websocket');

var _Websocket2 = _interopRequireDefault(_Websocket);

var _Timeline = require('./components/Timeline');

var _Timeline2 = _interopRequireDefault(_Timeline);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

if (process.env.HAIKU_RELEASE_ENVIRONMENT === 'production' || process.env.HAIKU_RELEASE_ENVIRONMENT === 'staging') {
  window.Raven.config('https://d045653ab5d44c808480fa6c3fa8e87c@sentry.io/226387', {
    environment: process.env.HAIKU_RELEASE_ENVIRONMENT || 'development',
    release: process.env.HAIKU_RELEASE_VERSION
  }).install();
  window.Raven.context(function () {
    go();
  });
} else {
  go();
}

function go() {
  // We are in a webview; use query string parameters for boot-up configuration
  var search = (window.location.search || '').split('?')[1] || '';
  var params = _qs2.default.parse(search, { plainObjects: true });
  var config = _lodash2.default.assign({}, params);
  if (!config.folder) throw new Error('A folder (the absolute path to the user project) is required');
  function _fixPlumbingUrl(url) {
    return url.replace(/^http/, 'ws');
  }

  var userconfig = require(_path2.default.join(config.folder, 'haiku.js'));

  var websocket = config.plumbing ? new _Websocket2.default(_fixPlumbingUrl(config.plumbing), config.folder, 'controllee', 'timeline') : { on: function on() {}, send: function send() {}, method: function method() {}, request: function request() {}, sendIfConnected: function sendIfConnected() {}, action: function action() {} };

  _reactDom2.default.render(_react2.default.createElement(_Timeline2.default, {
    envoy: config.envoy,
    userconfig: userconfig,
    websocket: websocket,
    folder: config.folder,
    __source: {
      fileName: _jsxFileName,
      lineNumber: 36
    },
    __self: this
  }), document.getElementById('root'));
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9pbmRleC5qcyJdLCJuYW1lcyI6WyJwcm9jZXNzIiwiZW52IiwiSEFJS1VfUkVMRUFTRV9FTlZJUk9OTUVOVCIsIndpbmRvdyIsIlJhdmVuIiwiY29uZmlnIiwiZW52aXJvbm1lbnQiLCJyZWxlYXNlIiwiSEFJS1VfUkVMRUFTRV9WRVJTSU9OIiwiaW5zdGFsbCIsImNvbnRleHQiLCJnbyIsInNlYXJjaCIsImxvY2F0aW9uIiwic3BsaXQiLCJwYXJhbXMiLCJwYXJzZSIsInBsYWluT2JqZWN0cyIsImFzc2lnbiIsImZvbGRlciIsIkVycm9yIiwiX2ZpeFBsdW1iaW5nVXJsIiwidXJsIiwicmVwbGFjZSIsInVzZXJjb25maWciLCJyZXF1aXJlIiwiam9pbiIsIndlYnNvY2tldCIsInBsdW1iaW5nIiwib24iLCJzZW5kIiwibWV0aG9kIiwicmVxdWVzdCIsInNlbmRJZkNvbm5lY3RlZCIsImFjdGlvbiIsInJlbmRlciIsImVudm95IiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCJdLCJtYXBwaW5ncyI6Ijs7OztBQUFBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7Ozs7QUFFQSxJQUFJQSxRQUFRQyxHQUFSLENBQVlDLHlCQUFaLEtBQTBDLFlBQTFDLElBQTBERixRQUFRQyxHQUFSLENBQVlDLHlCQUFaLEtBQTBDLFNBQXhHLEVBQW1IO0FBQ2pIQyxTQUFPQyxLQUFQLENBQWFDLE1BQWIsQ0FBb0IsMkRBQXBCLEVBQWlGO0FBQy9FQyxpQkFBYU4sUUFBUUMsR0FBUixDQUFZQyx5QkFBWixJQUF5QyxhQUR5QjtBQUUvRUssYUFBU1AsUUFBUUMsR0FBUixDQUFZTztBQUYwRCxHQUFqRixFQUdHQyxPQUhIO0FBSUFOLFNBQU9DLEtBQVAsQ0FBYU0sT0FBYixDQUFxQixZQUFZO0FBQy9CQztBQUNELEdBRkQ7QUFHRCxDQVJELE1BUU87QUFDTEE7QUFDRDs7QUFFRCxTQUFTQSxFQUFULEdBQWU7QUFDYjtBQUNBLE1BQU1DLFNBQVMsQ0FBQ1QsT0FBT1UsUUFBUCxDQUFnQkQsTUFBaEIsSUFBMEIsRUFBM0IsRUFBK0JFLEtBQS9CLENBQXFDLEdBQXJDLEVBQTBDLENBQTFDLEtBQWdELEVBQS9EO0FBQ0EsTUFBTUMsU0FBUyxhQUFHQyxLQUFILENBQVNKLE1BQVQsRUFBaUIsRUFBRUssY0FBYyxJQUFoQixFQUFqQixDQUFmO0FBQ0EsTUFBTVosU0FBUyxpQkFBT2EsTUFBUCxDQUFjLEVBQWQsRUFBa0JILE1BQWxCLENBQWY7QUFDQSxNQUFJLENBQUNWLE9BQU9jLE1BQVosRUFBb0IsTUFBTSxJQUFJQyxLQUFKLENBQVUsOERBQVYsQ0FBTjtBQUNwQixXQUFTQyxlQUFULENBQTBCQyxHQUExQixFQUErQjtBQUFFLFdBQU9BLElBQUlDLE9BQUosQ0FBWSxPQUFaLEVBQXFCLElBQXJCLENBQVA7QUFBbUM7O0FBRXBFLE1BQU1DLGFBQWFDLFFBQVEsZUFBS0MsSUFBTCxDQUFVckIsT0FBT2MsTUFBakIsRUFBeUIsVUFBekIsQ0FBUixDQUFuQjs7QUFFQSxNQUFNUSxZQUFhdEIsT0FBT3VCLFFBQVIsR0FDZCx3QkFBY1AsZ0JBQWdCaEIsT0FBT3VCLFFBQXZCLENBQWQsRUFBZ0R2QixPQUFPYyxNQUF2RCxFQUErRCxZQUEvRCxFQUE2RSxVQUE3RSxDQURjLEdBRWQsRUFBRVUsSUFBSSxjQUFNLENBQUUsQ0FBZCxFQUFnQkMsTUFBTSxnQkFBTSxDQUFFLENBQTlCLEVBQWdDQyxRQUFRLGtCQUFNLENBQUUsQ0FBaEQsRUFBa0RDLFNBQVMsbUJBQU0sQ0FBRSxDQUFuRSxFQUFxRUMsaUJBQWlCLDJCQUFNLENBQUUsQ0FBOUYsRUFBZ0dDLFFBQVEsa0JBQU0sQ0FBRSxDQUFoSCxFQUZKOztBQUlBLHFCQUFTQyxNQUFULENBQ0U7QUFDRSxXQUFPOUIsT0FBTytCLEtBRGhCO0FBRUUsZ0JBQVlaLFVBRmQ7QUFHRSxlQUFXRyxTQUhiO0FBSUUsWUFBUXRCLE9BQU9jLE1BSmpCO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLElBREYsRUFPRWtCLFNBQVNDLGNBQVQsQ0FBd0IsTUFBeEIsQ0FQRjtBQVNEIiwiZmlsZSI6ImluZGV4LmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0J1xuaW1wb3J0IFJlYWN0RE9NIGZyb20gJ3JlYWN0LWRvbSdcbmltcG9ydCBsb2Rhc2ggZnJvbSAnbG9kYXNoJ1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCdcbmltcG9ydCBxcyBmcm9tICdxcydcbmltcG9ydCBXZWJzb2NrZXQgZnJvbSAnaGFpa3Utc2VyaWFsaXphdGlvbi9zcmMvd3MvV2Vic29ja2V0J1xuaW1wb3J0IFRpbWVsaW5lIGZyb20gJy4vY29tcG9uZW50cy9UaW1lbGluZSdcblxuaWYgKHByb2Nlc3MuZW52LkhBSUtVX1JFTEVBU0VfRU5WSVJPTk1FTlQgPT09ICdwcm9kdWN0aW9uJyB8fCBwcm9jZXNzLmVudi5IQUlLVV9SRUxFQVNFX0VOVklST05NRU5UID09PSAnc3RhZ2luZycpIHtcbiAgd2luZG93LlJhdmVuLmNvbmZpZygnaHR0cHM6Ly9kMDQ1NjUzYWI1ZDQ0YzgwODQ4MGZhNmMzZmE4ZTg3Y0BzZW50cnkuaW8vMjI2Mzg3Jywge1xuICAgIGVudmlyb25tZW50OiBwcm9jZXNzLmVudi5IQUlLVV9SRUxFQVNFX0VOVklST05NRU5UIHx8ICdkZXZlbG9wbWVudCcsXG4gICAgcmVsZWFzZTogcHJvY2Vzcy5lbnYuSEFJS1VfUkVMRUFTRV9WRVJTSU9OXG4gIH0pLmluc3RhbGwoKVxuICB3aW5kb3cuUmF2ZW4uY29udGV4dChmdW5jdGlvbiAoKSB7XG4gICAgZ28oKVxuICB9KVxufSBlbHNlIHtcbiAgZ28oKVxufVxuXG5mdW5jdGlvbiBnbyAoKSB7XG4gIC8vIFdlIGFyZSBpbiBhIHdlYnZpZXc7IHVzZSBxdWVyeSBzdHJpbmcgcGFyYW1ldGVycyBmb3IgYm9vdC11cCBjb25maWd1cmF0aW9uXG4gIGNvbnN0IHNlYXJjaCA9ICh3aW5kb3cubG9jYXRpb24uc2VhcmNoIHx8ICcnKS5zcGxpdCgnPycpWzFdIHx8ICcnXG4gIGNvbnN0IHBhcmFtcyA9IHFzLnBhcnNlKHNlYXJjaCwgeyBwbGFpbk9iamVjdHM6IHRydWUgfSlcbiAgY29uc3QgY29uZmlnID0gbG9kYXNoLmFzc2lnbih7fSwgcGFyYW1zKVxuICBpZiAoIWNvbmZpZy5mb2xkZXIpIHRocm93IG5ldyBFcnJvcignQSBmb2xkZXIgKHRoZSBhYnNvbHV0ZSBwYXRoIHRvIHRoZSB1c2VyIHByb2plY3QpIGlzIHJlcXVpcmVkJylcbiAgZnVuY3Rpb24gX2ZpeFBsdW1iaW5nVXJsICh1cmwpIHsgcmV0dXJuIHVybC5yZXBsYWNlKC9eaHR0cC8sICd3cycpIH1cblxuICBjb25zdCB1c2VyY29uZmlnID0gcmVxdWlyZShwYXRoLmpvaW4oY29uZmlnLmZvbGRlciwgJ2hhaWt1LmpzJykpXG5cbiAgY29uc3Qgd2Vic29ja2V0ID0gKGNvbmZpZy5wbHVtYmluZylcbiAgICA/IG5ldyBXZWJzb2NrZXQoX2ZpeFBsdW1iaW5nVXJsKGNvbmZpZy5wbHVtYmluZyksIGNvbmZpZy5mb2xkZXIsICdjb250cm9sbGVlJywgJ3RpbWVsaW5lJylcbiAgICA6IHsgb246ICgpID0+IHt9LCBzZW5kOiAoKSA9PiB7fSwgbWV0aG9kOiAoKSA9PiB7fSwgcmVxdWVzdDogKCkgPT4ge30sIHNlbmRJZkNvbm5lY3RlZDogKCkgPT4ge30sIGFjdGlvbjogKCkgPT4ge30gfVxuXG4gIFJlYWN0RE9NLnJlbmRlcihcbiAgICA8VGltZWxpbmVcbiAgICAgIGVudm95PXtjb25maWcuZW52b3l9XG4gICAgICB1c2VyY29uZmlnPXt1c2VyY29uZmlnfVxuICAgICAgd2Vic29ja2V0PXt3ZWJzb2NrZXR9XG4gICAgICBmb2xkZXI9e2NvbmZpZy5mb2xkZXJ9XG4gICAgICAvPixcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncm9vdCcpXG4gIClcbn1cbiJdfQ==